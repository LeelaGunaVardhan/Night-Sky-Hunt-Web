<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Night Sky Hunt</title>
    <!-- Google Font for Stylish Title -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Styles here (same as before or as needed) */
    </style>
</head>
<body>

    <!-- Starfield Background -->
    <div class="starfield" id="starfield"></div>

    <!-- Title -->
    <div class="title">Night Sky Hunt</div>

    <!-- Button Container -->
    <div class="button-container" id="buttonContainer">
        <button class="main-button" onclick="openRegisterModal()">Register Team</button>
        <button class="main-button" onclick="openLoginModal()">Team Login</button>
        <button class="main-button" onclick="openAdminLoginModal()">Admin Login</button>
    </div>

    <!-- Register Team Modal -->
    <div id="registerModal" class="modal">
        <!-- Modal content here -->
    </div>

    <!-- Team Login Modal -->
    <div id="loginModal" class="modal">
        <!-- Modal content here -->
    </div>

    <!-- Coordinate Display -->
    <div id="coordinateContainer" style="display: none;">
        <h2>Your Coordinates</h2>
        <div id="coordinateDisplay"></div>
        <input type="text" id="codeInput" placeholder="Enter your 6-digit code..." maxlength="6">
        <button onclick="submitCode()">Submit Code</button>
        <div id="message"></div>
        <button onclick="logoutTeam()">Logout</button>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- JavaScript -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCyVBia-bsTSwZSmGrztGGeyGvbk-3vGUM",
            authDomain: "night-sky-hunt-af24d.firebaseapp.com",
            databaseURL: "https://night-sky-hunt-af24d-default-rtdb.firebaseio.com",
            projectId: "night-sky-hunt-af24d",
            storageBucket: "night-sky-hunt-af24d.appspot.com",
            messagingSenderId: "649615581460",
            appId: "1:649615581460:web:13d2c0d15161e1ef43e201",
            measurementId: "G-YBD7B53TJJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variables
        let currentTeamId = null;

        // Coordinates and Codes
        const coordinates = {
            1: [9.52, 12.81],
            2: [9.22, 11.43],
            3: [10.14, 10.75],
            4: [11.59, 10.80],
            5: [11.67, 9.59],
            6: [10.74, 6.86],
            7: [9.44, 5.75],
            8: [9.00, 6.86],
            9: [8.59, 7.86],
            10: [6.52, 6.64],
            11: [5.85, 5.80],
            12: [4.07, 5.86],
            13: [3.44, 8.00],
            14: [5.07, 9.53],
            15: [7.00, 8.70],
            16: [7.00, 9.64],
            17: [8.00, 11.00],
            18: [6.07, 4.14],
            19: [10.44, 12.00],
            20: [11.52, 8.44]
        };

        const questionCodes = {
            1: 3742,
            2: 8169,
            3: 2905,
            4: 6471,
            5: 5038,
            6: 7294,
            7: 1806,
            8: 9532,
            9: 4087,
            10: 6129,
            11: 3748,
            12: 5902,
            13: 8251,
            14: 4937,
            15: 1065,
            16: 7489,
            17: 2541,
            18: 6390,
            19: 4718,
            20: 8023
        };

        // Registration Function
        function registerTeam() {
            // Get form values
            const teamName = document.getElementById('teamName').value.trim();
            const password = document.getElementById('teamPassword').value.trim();
            const member1 = document.getElementById('member1').value.trim();
            const member2 = document.getElementById('member2').value.trim();

            // Validation
            if (teamName === '' || password === '' || member1 === '' || member2 === '') {
                alert('Please fill all fields.');
                return;
            }

            // Check if team already exists
            firebase.database().ref('teams').orderByChild('teamName').equalTo(teamName).once('value', snapshot => {
                if (snapshot.exists()) {
                    alert('Team name already exists.');
                } else {
                    // Generate team ID
                    const teamId = firebase.database().ref().child('teams').push().key;

                    // Generate random sequence
                    const sequence = generateRandomSequence(20);

                    // Save team data
                    firebase.database().ref('teams/' + teamId).set({
                        teamName: teamName,
                        password: password,
                        members: [member1, member2],
                        sequence: sequence,
                        currentIndex: 0,
                        score: 0
                    }).then(() => {
                        alert('Team registered successfully!');
                        closeModal('registerModal');
                    });
                }
            });
        }

        // Generate Random Sequence
        function generateRandomSequence(n) {
            const array = Array.from({length: n}, (_, index) => index + 1);
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Team Login Function
        function loginTeam() {
            const teamName = document.getElementById('loginTeamName').value.trim();
            const password = document.getElementById('loginTeamPassword').value.trim();

            firebase.database().ref('teams').orderByChild('teamName').equalTo(teamName).once('value', snapshot => {
                if (snapshot.exists()) {
                    snapshot.forEach(childSnapshot => {
                        const team = childSnapshot.val();
                        if (team.password === password) {
                            currentTeamId = childSnapshot.key;
                            alert('Login successful!');
                            closeModal('loginModal');
                            showCoordinates();
                        } else {
                            alert('Incorrect password.');
                        }
                    });
                } else {
                    alert('Team not found.');
                }
            });
        }

        // Show Coordinates
        function showCoordinates() {
            firebase.database().ref('teams/' + currentTeamId).once('value', snapshot => {
                const team = snapshot.val();
                const sequence = team.sequence;
                const currentIndex = team.currentIndex;
                const questionNumber = sequence[currentIndex];
                const coord = coordinates[questionNumber];
                document.getElementById('coordinateDisplay').textContent = `(${coord[0]}, ${coord[1]})`;
                document.getElementById('coordinateContainer').style.display = 'block';
                document.getElementById('buttonContainer').style.display = 'none';
            });
        }

        // Submit Code Function
        function submitCode() {
            const codeInput = document.getElementById('codeInput').value.trim();
            if (codeInput.length !==6) {
                alert('Please enter a valid 6-digit code.');
                return;
            }
            const code = parseInt(codeInput.slice(2));

            firebase.database().ref('teams/' + currentTeamId).once('value', snapshot => {
                const team = snapshot.val();
                const sequence = team.sequence;
                let currentIndex = team.currentIndex;
                const questionNumber = sequence[currentIndex];
                const correctCode = questionCodes[questionNumber];

                if (code === correctCode) {
                    // Correct code
                    currentIndex++;
                    let score = team.score + 5;
                    firebase.database().ref('teams/' + currentTeamId).update({
                        currentIndex: currentIndex,
                        score: score
                    }).then(() => {
                        if (currentIndex < sequence.length) {
                            showCoordinates();
                            document.getElementById('message').textContent = 'Correct code! Proceed to next coordinate.';
                        } else {
                            document.getElementById('coordinateDisplay').textContent = '';
                            document.getElementById('message').textContent = 'Congratulations! You have completed all questions!';
                        }
                    });
                } else {
                    alert('Incorrect code. Try again.');
                }
            });
        }

        // Logout Team
        function logoutTeam() {
            currentTeamId = null;
            document.getElementById('coordinateContainer').style.display = 'none';
            document.getElementById('buttonContainer').style.display = 'flex';
            document.getElementById('coordinateDisplay').textContent = '';
            document.getElementById('message').textContent = '';
            document.getElementById('codeInput').value = '';
        }

        // Modal Functions
        function openRegisterModal() {
            document.getElementById('registerModal').style.display = 'block';
        }

        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Add your additional functions as needed

    </script>

</body>
</html>

